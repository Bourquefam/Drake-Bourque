@using EF = System.Data.Entity;

@{
    // Manually run the database initializer to ensure that the Users table
    // exists before WebSecurity.InitializeDatabaseConnection is run.
    var initializer = new EF.MigrateDatabaseToLatestVersion<Provider.Models.ProviderContext, Provider.Migrations.Configuration>();
    EF.Database.SetInitializer(initializer);
    initializer.InitializeDatabase(new Provider.Models.ProviderContext());

    WebSecurity.InitializeDatabaseConnection("DefaultConnection", "Users", "UserId", "UserName", autoCreateTables: true);

    var membership = (SimpleMembershipProvider)Membership.Provider;
    
    // A couple of default accounts
    if (membership.GetUser("Admin", false) == null)
    {
        membership.CreateUserAndAccount("Admin", "password");
    }
    if (membership.GetUser("Author", false) == null)
    {
        membership.CreateUserAndAccount("Author", "password");
    }
}
